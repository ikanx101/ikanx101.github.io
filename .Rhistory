group_by(away_team) %>%
summarise(home_goal = sum(fthg),
away_goal = sum(ftag),
play = n(),
ratio_goal_at_away = home_goal/play,
ratio_goal_against_home_at_away = away_goal/play) %>%
ungroup() %>%
mutate(all_home_goals = sum(home_goal)/sum(play),
all_away_goals = sum(away_goal)/sum(play),
away_attack = ratio_goal_against_home_at_away/all_away_goals,
away_defense = ratio_goal_at_away/all_home_goals,
overall_away = away_attack - away_defense) %>%
select(away_team,away_attack,away_defense,overall_away)
away
xgoal = function(tim_kandang,tim_tamu){
home =
home %>%
filter(home_team == tim_kandang)
away =
away %>%
filter(away_team == tim_tamu)
xgoal_home = home$home_attack * away$away_defense * avg_home_gol
xgoal_away = away$away_attack * home$home_defense * avg_away_gol
return(c(xgoal_home,xgoal_away))
}
# set tim yang bertanding
tim_home = "Manchester United"
tim_away = "Liverpool"
xgoal_data = xgoal(tim_home,tim_away)
prediksi_poisson = function(gol_home,xgoal_home_,gol_away,xgoal_away_){
dpois(x = gol_home, lambda = xgoal_home_) * dpois(x = gol_away, lambda = xgoal_away_) *100
}
# bikin data frame
pred = data.frame(skor_home = c(rep(0,6),rep(1,6),rep(2,6),rep(3,6),rep(4,6),rep(5,6)),
skor_away = rep(c(0:5),6))
pred$prob = prediksi_poisson(pred$skor_home,xgoal_data[1],pred$skor_away,xgoal_data[2])
library(ggplot2)
pred %>%
mutate(label = paste0(skor_home,"-",skor_away,"\nProb: ",round(prob,1),"%"),
skor_home = factor(skor_home,levels = c(0:10)),
skor_away = factor(skor_away,levels = c(0:10))) %>%
ggplot(aes(x = skor_home,y = skor_away,fill = prob)) +
geom_tile() +
geom_label(aes(label = label),size = 3) +
scale_fill_gradient2(low = "lightblue",high = "darkred",midpoint = 5) +
labs(x = tim_home,
y = tim_away)
pred %>%
mutate(hasil = case_when(skor_home > skor_away ~ tim_home,
skor_home < skor_away ~ tim_away,
skor_home == skor_away ~"Seri"),
hasil = factor(hasil,levels = c(tim_home,"Seri",tim_away))
) %>%
group_by(hasil) %>%
summarise(prob = sum(prob)) %>%
ungroup() %>%
mutate(label = round(prob,2),
label = paste0(label,"%")) %>%
ggplot(aes(x = hasil,
y = prob)) +
geom_col(color = "black") +
geom_label(aes(label=label)) +
ggthemes::theme_wsj() +
labs(title = "Who wins?",
subtitle = "Based on Poisson Model",
caption = "Simulasi menggunakan R\nikanx101.com") +
theme(axis.text.y = element_blank(),
plot.caption = element_text(size=10,face = "bold"))
View(home)
xgoal = function(tim_kandang,tim_tamu){
home =
home %>%
filter(home_team == tim_kandang)
away =
away %>%
filter(away_team == tim_tamu)
xgoal_home = home$home_attack * away$away_defense * avg_home_gol
xgoal_away = away$away_attack * home$home_defense * avg_away_gol
return(c(xgoal_home,xgoal_away))
}
# set tim yang bertanding
tim_home = "Man United	"
tim_away = "Liverpool"
xgoal_data = xgoal(tim_home,tim_away)
prediksi_poisson = function(gol_home,xgoal_home_,gol_away,xgoal_away_){
dpois(x = gol_home, lambda = xgoal_home_) * dpois(x = gol_away, lambda = xgoal_away_) *100
}
# bikin data frame
pred = data.frame(skor_home = c(rep(0,6),rep(1,6),rep(2,6),rep(3,6),rep(4,6),rep(5,6)),
skor_away = rep(c(0:5),6))
pred$prob = prediksi_poisson(pred$skor_home,xgoal_data[1],pred$skor_away,xgoal_data[2])
library(ggplot2)
pred %>%
mutate(label = paste0(skor_home,"-",skor_away,"\nProb: ",round(prob,1),"%"),
skor_home = factor(skor_home,levels = c(0:10)),
skor_away = factor(skor_away,levels = c(0:10))) %>%
ggplot(aes(x = skor_home,y = skor_away,fill = prob)) +
geom_tile() +
geom_label(aes(label = label),size = 3) +
scale_fill_gradient2(low = "lightblue",high = "darkred",midpoint = 5) +
labs(x = tim_home,
y = tim_away)
pred %>%
mutate(hasil = case_when(skor_home > skor_away ~ tim_home,
skor_home < skor_away ~ tim_away,
skor_home == skor_away ~"Seri"),
hasil = factor(hasil,levels = c(tim_home,"Seri",tim_away))
) %>%
group_by(hasil) %>%
summarise(prob = sum(prob)) %>%
ungroup() %>%
mutate(label = round(prob,2),
label = paste0(label,"%")) %>%
ggplot(aes(x = hasil,
y = prob)) +
geom_col(color = "black") +
geom_label(aes(label=label)) +
ggthemes::theme_wsj() +
labs(title = "Who wins?",
subtitle = "Based on Poisson Model",
caption = "Simulasi menggunakan R\nikanx101.com") +
theme(axis.text.y = element_blank(),
plot.caption = element_text(size=10,face = "bold"))
xgoal = function(tim_kandang,tim_tamu){
home =
home %>%
filter(home_team == tim_kandang)
away =
away %>%
filter(away_team == tim_tamu)
xgoal_home = home$home_attack * away$away_defense * avg_home_gol
xgoal_away = away$away_attack * home$home_defense * avg_away_gol
return(c(xgoal_home,xgoal_away))
}
# set tim yang bertanding
tim_home = "Man United"
tim_away = "Liverpool"
xgoal_data = xgoal(tim_home,tim_away)
prediksi_poisson = function(gol_home,xgoal_home_,gol_away,xgoal_away_){
dpois(x = gol_home, lambda = xgoal_home_) * dpois(x = gol_away, lambda = xgoal_away_) *100
}
# bikin data frame
pred = data.frame(skor_home = c(rep(0,6),rep(1,6),rep(2,6),rep(3,6),rep(4,6),rep(5,6)),
skor_away = rep(c(0:5),6))
pred$prob = prediksi_poisson(pred$skor_home,xgoal_data[1],pred$skor_away,xgoal_data[2])
library(ggplot2)
pred %>%
mutate(label = paste0(skor_home,"-",skor_away,"\nProb: ",round(prob,1),"%"),
skor_home = factor(skor_home,levels = c(0:10)),
skor_away = factor(skor_away,levels = c(0:10))) %>%
ggplot(aes(x = skor_home,y = skor_away,fill = prob)) +
geom_tile() +
geom_label(aes(label = label),size = 3) +
scale_fill_gradient2(low = "lightblue",high = "darkred",midpoint = 5) +
labs(x = tim_home,
y = tim_away)
pred %>%
mutate(hasil = case_when(skor_home > skor_away ~ tim_home,
skor_home < skor_away ~ tim_away,
skor_home == skor_away ~"Seri"),
hasil = factor(hasil,levels = c(tim_home,"Seri",tim_away))
) %>%
group_by(hasil) %>%
summarise(prob = sum(prob)) %>%
ungroup() %>%
mutate(label = round(prob,2),
label = paste0(label,"%")) %>%
ggplot(aes(x = hasil,
y = prob)) +
geom_col(color = "black") +
geom_label(aes(label=label)) +
ggthemes::theme_wsj() +
labs(title = "Who wins?",
subtitle = "Based on Poisson Model",
caption = "Simulasi menggunakan R\nikanx101.com") +
theme(axis.text.y = element_blank(),
plot.caption = element_text(size=10,face = "bold"))
knitr::opts_chunk$set(echo = TRUE)
rm(list=ls())
setwd("~/Documents/ikanx101.com/_posts/EPL/poisson")
library(dplyr)
library(ggplot2)
library(tidyr)
data_1 =
read.csv("/home/ikanx101githubio/Documents/belajaR/Bukan Infografis/EPL/EPL 2019.csv") %>%
janitor::clean_names() %>%
select(home_team,away_team,fthg,ftag)
data_2 =
read.csv("/home/ikanx101githubio/Documents/belajaR/Bukan Infografis/EPL/EPL 2018.csv") %>%
janitor::clean_names()%>%
select(home_team,away_team,fthg,ftag)
data = rbind(data_1,data_2)
avg_home_gol = sum(data$fthg)/length(data$home_team)
avg_away_gol = sum(data$ftag)/length(data$away_team)
# pertama adalah home
home =
data %>%
select(home_team,fthg,ftag) %>%
group_by(home_team) %>%
summarise(home_goal = sum(fthg),
away_goal = sum(ftag),
play = n(),
ratio_goal_at_home = home_goal/play,
ratio_goal_against_away_at_home = away_goal/play) %>%
ungroup() %>%
mutate(all_home_goals = sum(home_goal)/sum(play),
all_away_goals = sum(away_goal)/sum(play),
home_attack = ratio_goal_at_home/all_home_goals,
home_defense = ratio_goal_against_away_at_home/all_away_goals,
overall_home = home_attack - home_defense) %>%
select(home_team,home_attack,home_defense,overall_home)
# kedua adalah away
away =
data %>%
select(away_team,fthg,ftag) %>%
group_by(away_team) %>%
summarise(home_goal = sum(fthg),
away_goal = sum(ftag),
play = n(),
ratio_goal_at_away = home_goal/play,
ratio_goal_against_home_at_away = away_goal/play) %>%
ungroup() %>%
mutate(all_home_goals = sum(home_goal)/sum(play),
all_away_goals = sum(away_goal)/sum(play),
away_attack = ratio_goal_against_home_at_away/all_away_goals,
away_defense = ratio_goal_at_away/all_home_goals,
overall_away = away_attack - away_defense) %>%
select(away_team,away_attack,away_defense,overall_away)
away
xgoal = function(tim_kandang,tim_tamu){
home =
home %>%
filter(home_team == tim_kandang)
away =
away %>%
filter(away_team == tim_tamu)
xgoal_home = home$home_attack * away$away_defense * avg_home_gol
xgoal_away = away$away_attack * home$home_defense * avg_away_gol
return(c(xgoal_home,xgoal_away))
}
# set tim yang bertanding
tim_home = "Man United"
tim_away = "Liverpool"
xgoal_data = xgoal(tim_home,tim_away)
prediksi_poisson = function(gol_home,xgoal_home_,gol_away,xgoal_away_){
dpois(x = gol_home, lambda = xgoal_home_) * dpois(x = gol_away, lambda = xgoal_away_) *100
}
# bikin data frame
pred = data.frame(skor_home = c(rep(0,6),rep(1,6),rep(2,6),rep(3,6),rep(4,6),rep(5,6)),
skor_away = rep(c(0:5),6))
pred$prob = prediksi_poisson(pred$skor_home,xgoal_data[1],pred$skor_away,xgoal_data[2])
library(ggplot2)
pred %>%
mutate(label = paste0(skor_home,"-",skor_away,"\nProb: ",round(prob,1),"%"),
skor_home = factor(skor_home,levels = c(0:10)),
skor_away = factor(skor_away,levels = c(0:10))) %>%
ggplot(aes(x = skor_home,y = skor_away,fill = prob)) +
geom_tile() +
geom_label(aes(label = label),size = 3) +
scale_fill_gradient2(low = "lightblue",high = "darkred",midpoint = 5) +
labs(x = tim_home,
y = tim_away)
pred %>%
mutate(hasil = case_when(skor_home > skor_away ~ tim_home,
skor_home < skor_away ~ tim_away,
skor_home == skor_away ~"Seri"),
hasil = factor(hasil,levels = c(tim_home,"Seri",tim_away))
) %>%
group_by(hasil) %>%
summarise(prob = sum(prob)) %>%
ungroup() %>%
mutate(label = round(prob,2),
label = paste0(label,"%")) %>%
ggplot(aes(x = hasil,
y = prob)) +
geom_col(color = "black") +
geom_label(aes(label=label)) +
ggthemes::theme_wsj() +
labs(title = "Who wins?",
subtitle = "Based on Poisson Model",
caption = "Simulasi menggunakan R\nikanx101.com") +
theme(axis.text.y = element_blank(),
plot.caption = element_text(size=10,face = "bold"))
xgoal = function(tim_kandang,tim_tamu){
home =
home %>%
filter(home_team == tim_kandang)
away =
away %>%
filter(away_team == tim_tamu)
xgoal_home = home$home_attack * away$away_defense * avg_home_gol
xgoal_away = away$away_attack * home$home_defense * avg_away_gol
return(c(xgoal_home,xgoal_away))
}
# set tim yang bertanding
tim_home = "Arsenal"
tim_away = "Liverpool"
xgoal_data = xgoal(tim_home,tim_away)
prediksi_poisson = function(gol_home,xgoal_home_,gol_away,xgoal_away_){
dpois(x = gol_home, lambda = xgoal_home_) * dpois(x = gol_away, lambda = xgoal_away_) *100
}
# bikin data frame
pred = data.frame(skor_home = c(rep(0,6),rep(1,6),rep(2,6),rep(3,6),rep(4,6),rep(5,6)),
skor_away = rep(c(0:5),6))
pred$prob = prediksi_poisson(pred$skor_home,xgoal_data[1],pred$skor_away,xgoal_data[2])
library(ggplot2)
pred %>%
mutate(label = paste0(skor_home,"-",skor_away,"\nProb: ",round(prob,1),"%"),
skor_home = factor(skor_home,levels = c(0:10)),
skor_away = factor(skor_away,levels = c(0:10))) %>%
ggplot(aes(x = skor_home,y = skor_away,fill = prob)) +
geom_tile() +
geom_label(aes(label = label),size = 3) +
scale_fill_gradient2(low = "lightblue",high = "darkred",midpoint = 5) +
labs(x = tim_home,
y = tim_away)
pred %>%
mutate(hasil = case_when(skor_home > skor_away ~ tim_home,
skor_home < skor_away ~ tim_away,
skor_home == skor_away ~"Seri"),
hasil = factor(hasil,levels = c(tim_home,"Seri",tim_away))
) %>%
group_by(hasil) %>%
summarise(prob = sum(prob)) %>%
ungroup() %>%
mutate(label = round(prob,2),
label = paste0(label,"%")) %>%
ggplot(aes(x = hasil,
y = prob)) +
geom_col(color = "black") +
geom_label(aes(label=label)) +
ggthemes::theme_wsj() +
labs(title = "Who wins?",
subtitle = "Based on Poisson Model",
caption = "Simulasi menggunakan R\nikanx101.com") +
theme(axis.text.y = element_blank(),
plot.caption = element_text(size=10,face = "bold"))
xgoal_data
pred %>%
mutate(label = paste0(skor_home,"-",skor_away,"\nProb: ",round(prob,1),"%"),
skor_home = factor(skor_home,levels = c(0:10)),
skor_away = factor(skor_away,levels = c(0:10))) %>%
ggplot(aes(x = skor_home,y = skor_away,fill = prob)) +
geom_tile() +
geom_label(aes(label = label),size = 3) +
scale_fill_gradient2(low = "lightblue",high = "darkred",midpoint = "none") +
labs(x = tim_home,
y = tim_away)
pred %>%
mutate(label = paste0(skor_home,"-",skor_away,"\nProb: ",round(prob,1),"%"),
skor_home = factor(skor_home,levels = c(0:10)),
skor_away = factor(skor_away,levels = c(0:10))) %>%
ggplot(aes(x = skor_home,y = skor_away,fill = prob)) +
geom_tile() +
geom_label(aes(label = label),size = 3) +
scale_fill_gradient2(low = "lightblue",high = "darkred",midpoint = 0) +
labs(x = tim_home,
y = tim_away)
pred %>%
mutate(label = paste0(skor_home,"-",skor_away,"\nProb: ",round(prob,1),"%"),
skor_home = factor(skor_home,levels = c(0:10)),
skor_away = factor(skor_away,levels = c(0:10))) %>%
ggplot(aes(x = skor_home,y = skor_away,fill = prob)) +
geom_tile() +
geom_label(aes(label = label),size = 3) +
scale_fill_gradient2(low = "lightblue",high = "darkred",midpoint = 7) +
labs(x = tim_home,
y = tim_away)
pred %>%
mutate(label = paste0(skor_home,"-",skor_away,"\nProb: ",round(prob,1),"%"),
skor_home = factor(skor_home,levels = c(0:10)),
skor_away = factor(skor_away,levels = c(0:10))) %>%
ggplot(aes(x = skor_home,y = skor_away,fill = prob)) +
geom_tile() +
geom_label(aes(label = label),size = 3) +
scale_fill_gradient2(low = "lightblue",high = "darkred",midpoint = 0) +
labs(x = tim_home,
y = tim_away)
pred %>%
mutate(label = paste0(skor_home,"-",skor_away,"\nProb: ",round(prob,1),"%"),
skor_home = factor(skor_home,levels = c(0:10)),
skor_away = factor(skor_away,levels = c(0:10))) %>%
ggplot(aes(x = skor_home,y = skor_away,fill = prob)) +
geom_tile() +
geom_label(aes(label = label),size = 3) +
scale_fill_gradient2(low = "lightblue",high = "darkred",midpoint = 4) +
labs(x = tim_home,
y = tim_away)
knitr::opts_chunk$set(echo = TRUE)
rm(list=ls())
setwd("~/Documents/ikanx101.com/_posts/EPL/poisson")
library(dplyr)
library(ggplot2)
library(tidyr)
xgoal = function(tim_kandang,tim_tamu){
home =
home %>%
filter(home_team == tim_kandang)
away =
away %>%
filter(away_team == tim_tamu)
xgoal_home = home$home_attack * away$away_defense * avg_home_gol
xgoal_away = away$away_attack * home$home_defense * avg_away_gol
return(c(xgoal_home,xgoal_away))
}
# set tim yang bertanding
tim_home = "Arsenal"
tim_away = "Liverpool"
xgoal_data = xgoal(tim_home,tim_away)
knitr::opts_chunk$set(echo = TRUE)
rm(list=ls())
setwd("~/Documents/ikanx101.com/_posts/EPL/poisson")
library(dplyr)
library(ggplot2)
library(tidyr)
nomnoml::nomnoml("#direction: down,
[Data Mentah] -> [Data Bersih]
[Data Bersih] -> [Dist Poisson]
[Dist Poisson] -> [Visualisasi]
[Data Mentah|
[EPL 2018/2019] -> [Gabung]
[EPL 2019/2020] -> [Gabung]
]
[Data Bersih|
[Gabung] -> [Data Tim Home]
[Gabung] -> [Data Tim Away]
[Data Tim Home] -> [Hitung Attack dan Defense]
[Data Tim Away] -> [Hitung Attack dan Defense]
[Hitung Attack dan Defense] -> [Data Attack dan Defense Tim Home]
[Hitung Attack dan Defense] -> [Data Attack dan Defense Tim Away]
]
[Dist Poisson|
[Data Attack dan Defense Tim Home] -> [Selected Tim Home]
[Data Attack dan Defense Tim Away] -> [Selected Tim Away]
[Selected Tim Home] -> [Hitung Expected Goal]
[Selected Tim Away] -> [Hitung Expected Goal]
[Hitung Expected Goal] -> [Hitung Peluang]
[Hitung Peluang] -> [Matrix Peluang]
]
[Visualisasi|
[Matrix Peluang] -> [geom_tile()]
[Matrix Peluang] -> [geom_col()]
]
")
data_2 =
read.csv("/home/ikanx101githubio/Documents/belajaR/Bukan Infografis/EPL/EPL 2019.csv") %>%
janitor::clean_names() %>%
select(date,home_team,away_team,fthg,ftag)
data_1 =
read.csv("/home/ikanx101githubio/Documents/belajaR/Bukan Infografis/EPL/EPL 2018.csv") %>%
janitor::clean_names()%>%
select(date,home_team,away_team,fthg,ftag)
data = rbind(data_1,data_2)
data %>%
rename(home_goals = fthg,
away_goals = ftag) %>%
head(10) %>%
knitr::kable()
avg_home_gol = sum(data$fthg)/length(data$home_team)
avg_away_gol = sum(data$ftag)/length(data$away_team)
# pertama adalah home
home =
data %>%
select(home_team,fthg,ftag) %>%
group_by(home_team) %>%
summarise(home_goal = sum(fthg),
away_goal = sum(ftag),
play = n(),
ratio_goal_at_home = home_goal/play,
ratio_goal_against_away_at_home = away_goal/play) %>%
ungroup() %>%
mutate(all_home_goals = sum(home_goal)/sum(play),
all_away_goals = sum(away_goal)/sum(play),
home_attack = ratio_goal_at_home/all_home_goals,
home_defense = ratio_goal_against_away_at_home/all_away_goals,
overall_home = home_attack - home_defense) %>%
select(home_team,home_attack,home_defense,overall_home)
# kedua adalah away
away =
data %>%
select(away_team,fthg,ftag) %>%
group_by(away_team) %>%
summarise(home_goal = sum(fthg),
away_goal = sum(ftag),
play = n(),
ratio_goal_at_away = home_goal/play,
ratio_goal_against_home_at_away = away_goal/play) %>%
ungroup() %>%
mutate(all_home_goals = sum(home_goal)/sum(play),
all_away_goals = sum(away_goal)/sum(play),
away_attack = ratio_goal_against_home_at_away/all_away_goals,
away_defense = ratio_goal_at_away/all_home_goals,
overall_away = away_attack - away_defense) %>%
select(away_team,away_attack,away_defense,overall_away)
knitr::kable(head(home),"html",caption = "Contoh Data Home")
knitr::kable(head(away),"html",caption = "Contoh Data Away")
xgoal = function(tim_kandang,tim_tamu){
home =
home %>%
filter(home_team == tim_kandang)
away =
away %>%
filter(away_team == tim_tamu)
xgoal_home = home$home_attack * away$away_defense * avg_home_gol
xgoal_away = away$away_attack * home$home_defense * avg_away_gol
return(c(xgoal_home,xgoal_away))
}
# set tim yang bertanding
tim_home = "Arsenal"
tim_away = "Liverpool"
xgoal_data = xgoal(tim_home,tim_away)
xgoal_data
