---
title: "Untitled"
format:
  gfm:
    html-math-method: webtex
fig-dpi: 500
fig-width: 8
fig-height: 4.5
editor: source
execute:
  warning: false
  error: false
  echo: false
---

Pada tahun ini, saya kembali akan melakukan survey panelis untuk melihat _customer churn_ di beberapa produk. Terakhir kali saya memegang _project_ semacam ini adalah pada saat saya masih bekerja di _market research consultant / agency_ pada tahun 2010-2012.

Saat sedang mempersiapkan proposal risetnya, saya coba iseng bertanya ke salah satu __GenAI__ untuk menuliskan _analysis plan_-nya.

> Dari sekian banyak _analysis plan_ yang dia berikan, ada satu analisa yang ternyata belum pernah sama sekali saya gunakan sepanjang karir saya, yakni _survival analysis_.

Oleh karena itu, pada tulisan kali ini saya akan coba bahas apa itu _survival analysis_ dan apa aplikasinya.

---

_Survival analysis_ adalah salah satu cara pintar untuk menghitung **berapa lama waktu yang dibutuhkan sampai suatu _event_ terjadi**.

Bayangkan kita mulai dari titik awal, seperti saat **anak kecil pertama kali diberikan mainan baru**. Kemudian kita mengamati dan menunggu dengan sabar sampai mainan itu **dilempar dan rusak**, yang dalam statistik sering disebut sebagai "kegagalan" (*failure*).

> Namun, dalam dunia nyata seringkali kita tidak tahu kapan persisnya mainan itu akan rusak karena adakalanya kita **berhenti melihat anak itu**. 

Misalnya saya sedang menunggu sebuah balok kayu jatuh, tetapi saya harus **pergi tidur** padahal baloknya masih berdiri tegak. Kita tahu balok tersebut bertahan *setidaknya* sampai jam tidur saya, tetapi kita tidak tahu kapan persisnya ia akan benar-benar jatuh nanti.

Kita menggunakan **probabilitas survival** untuk menebak: "Seberapa besar peluang mainan tersebut masih bagus setelah dua jam bermain?". Ada juga yang namanya **waktu survival median**, yaitu titik waktu di mana tepat **setengah (50%) dari semua mainan di dalam ruangan sudah rusak**.

Selain itu, kita bisa melihat _hazard_ yaitu seberapa besar **risiko mendadak** bahwa sesuatu akan rusak pada detik ini juga padahal ia masih baik-baik saja sampai saat itu.

Pada prakteknya, _survival analysis_ sering digunakan pada bidang medis untuk menghitung peluang kesembuhan pasien atas suatu pengobatan penyakit tertentu. Namun aplikasi _survival analysis_ sebenarnya bisa digunakan untuk bidang lain seperti _sales marketing_ dan _predictive maintenance_ untuk mesin di pabrik.

Saya akan berikan satu contoh detail mengenai penerapan _survival analysis_ pada kasus penggantian bola lampu di sebuah gedung perkantoran besar.

## Studi Kasus Pemeliharaan Gedung: "Umur Pakai Bola Lampu"

Suatu waktu, seorang _facility manager_ di sebuah gedung perkantoran memasang **1.000 bola lampu LED baru** di lobi dan di seluruh ruangan:

1. Untuk lobi dipasang __500 bola lampu__. Di lobi, lampu-lampu ini akan terus menyala selama 24 jam.
1. Untuk ruangan kantor dipasang __500 bula lampu__. Di ruangan kantor, lampu-lampu hanya dinyalakan di jam kerja saja.

Untuk mengoptimalkan anggaran pemeliharaan, ia melakukan studi _survival analysis_ untuk memahami kapan bola-bola lampu tersebut kemungkinan besar akan rusak dan padam. Oleh karena itu _manager_ tersebut melakukan beberapa tahap berikut ini:

**1. Menentukan Titik Awal dan Kejadian (*Event*)**

  - **Waktu Asal ($t_0$):** Studi dimulai pada hari pemasangan lampu secara serentak. Misalkan pada tanggal 1 Januari 2023 pukul 00:00.
  - **Kejadian Ketertarikan (*Event of Interest*):** Kejadian yang diamati adalah **"kematian" atau kerusakan bola lampu** (saat lampu berhenti berfungsi). 
  - **Variabel Hasil:** Waktu survival diukur dalam **jam penggunaan** sejak instalasi hingga lampu padam atau rusak.

**2. Menghadapi Data Tersensor (*Censoring*)**

Dalam dunia nyata, tidak semua bola lampu akan padam saat Anda melakukan analisis. Misalkan studi dilakukan pada rentang 5.000 jam setelah pemasangan. Setelah waktu studi berakhir, ternyata masih ada lampu yang menyala. Inilah keunggulan analisis survival dalam menangani data yang tidak lengkap:

- **Sensor Administratif:** Setelah 5.000 jam (studi berakhir), misalkan ada 600 lampu yang masih menyala. Kita tak pernah tahu kapan lampu-lampu ini akan padam tapi __sudah jelas__ lampu-lampu ini bertahan *setidaknya* 5.000 jam.
  - Ini disebut **sensor kanan (*right censoring*)**.
- **Sensor Acak:** Pada jam ke-1.000, sebanyak 50 lampu yang masih nyala terpaksa dilepas dan diganti dengan model lain. Meskipun lampu-lampu tersebut belum rusak, data umur mereka selama 1.000 jam tetap berharga dan dihitung sebagai data tersensor.
- **Pentingnya Data Tersensor:** Jika kita hanya menghitung lampu yang mati saja, kita akan mendapatkan estimasi umur lampu yang **salah (terlalu rendah)** karena mengabaikan informasi dari lampu-lampu yang awet.

**3. Menganalisis dengan R**

Menggunakan paket `survival` di __R__, _manager_ tersebut memasukkan data dan melakukan beberapa analisa kunci seperti:

- **Fungsi Survival ($S(t)$):**  Menghasilkan kurva yang menunjukkan probabilitas sebuah lampu masih berfungsi setelah waktu tertentu. 
- **Waktu Survival Median:** Ini adalah angka kunci bagi manajer gedungâ€”titik waktu di mana **50% dari seluruh lampu telah padam**. 

**4. Membandingkan Kelompok**

_Manager_ tersebut ingin tahu apakah lampu di **lobi** (yang menyala 24 jam) memiliki ketahanan yang sama dengan lampu di **kantor** (yang dimatikan di malam hari).

- Menggunakan **Uji Log-Rank**, kita dapat menentukan apakah perbedaan kurva survival kedua kelompok tersebut signifikan secara statistik atau hanya karena kebetulan.
- Jika data yang dimiliki lengkap, kita juga bisa menggunakan **Regresi Cox** untuk melihat faktor lain, seperti apakah **merek lampu** atau **suhu ruangan** meningkatkan risiko kerusakan secara signifikan.

Sekarang dari cerita tersebut, saya akan tunjukkan data simulasi yang dihadapi oleh _manager_ tersebut.

Pertama-tama, saya akan buat data _dummy_ terlebih dahulu:

```{r}
#| echo: true

rm(list=ls())

library(survival)
library(survminer)
library(dplyr)
library(tidyr)

set.seed(1234) # Agar hasil simulasi konsisten

# 1. Menentukan parameter simulasi
n <- 500 # Jumlah lampu per kelompok
study_end <- 5000 # Studi diakhiri pada jam ke-5000 (Sensor Administratif)

# 2. Membuat data untuk Kelompok Lobi (Risiko lebih tinggi/hazard besar)
# berdistribusi weibull rweibull(n, shape, scale)
time_lobi <- rweibull(n, shape = 2, scale = 3000)
group_lobi <- rep("Lobi", n)

# 3. Membuat data untuk Kelompok Kantor (Risiko lebih rendah/awet)
time_kantor <- rweibull(n, shape = 2, scale = 4500)
group_kantor <- rep("Kantor", n)

# 4. Menggabungkan data
data_lampu <- data.frame(
  hours = c(time_lobi, time_kantor),
  group = c(group_lobi, group_kantor)
)

# 5. Menerapkan Sensor Kanan (Right-Censoring)
# Jika lampu masih menyala saat studi berakhir (> 5000 jam), status = 0
data_lampu$status <- ifelse(data_lampu$hours > study_end, 0, 1)
data_lampu$hours <- pmin(data_lampu$hours, study_end) #

```

Berikut adalah sampel datanya:

```{r}
sampelnya = sample(1000,15) %>% sort()
data_lampu[sampelnya,] %>% knitr::kable()
```

Kolom `status = 0` menunjukkan bahwa lampu tersebut masih nyala sampai rentang studi berakhir (5.000 jam). Sedangkan `status = 1` menunjukkan bahwa lampu tersebut mati pada `hours` tertentu.

Sekarang kita akan lakukan _survival analysis_-nya:

```{r}
#| echo: true

# Membuat objek survival 
surv_obj <- Surv(time = data_lampu$hours, event = data_lampu$status)

# Menghitung estimasi Kaplan-Meier berdasarkan kelompok
fit_kelompok <- survfit(surv_obj ~ group, data = data_lampu)

# Menampilkan ringkasan termasuk Median Survival Time
print(fit_kelompok)
```

Dari tabel di atas, kita bisa melihat bahwa _median survival time_ lampu di lobi lebih singkat daripada lampu di kantor. Artinya pada waktu median tersebut, __50% dari populasi lampu__ masih nyala. Sang _manager_ bisa menjadwalkan pergantian lampu sebelum _median time_ agar lampu-lampu tidak keburu mati di sebagian besar area gedung.

Apakah perbedaan tersebut signifikan? Berikut adalah __Uji log-rank__-nya:


```{r}
#| echo: true

# Melakukan Uji Log-rank
uji_perbedaan <- survdiff(surv_obj ~ group, data = data_lampu)
print(uji_perbedaan)

```

Oleh karena kita dapatkan _p-value_ kecil (mendekati nol -- kurang dari __0.05__), maka bisa disimpulkan bahwa perbedaan _median survival time_ antara lampu di lobi dan kantor __berbeda signifikan__. Artinya _manager_ harus membuat dua jadwal berbeda untuk pergantian lampu di dua area tersebut.

Berikut ini adalah kurva _survival_-nya:

```{r}
#| fig-height: 7
#| fig-width: 7


# Visualisasi kurva survival
ggsurvplot(
  fit_kelompok,
  data = data_lampu,
  pval = TRUE,             # Menampilkan p-value dari Uji Log-rank 
  conf.int = TRUE,         # Menampilkan interval kepercayaan 95% 
  risk.table = TRUE,       # Menampilkan tabel jumlah lampu yang masih berisiko
  legend.labs = c("Kantor", "Lobi"),
  palette = c("#2E9FDF", "#E7B800"),
  xlab = "Jam Penggunaan",
  ylab = "Probabilitas Lampu Masih Menyala",
  title = "Analisis Ketahanan Bola Lampu: Lobi vs Kantor"
)
```

Dari kurva di atas, _manager_ bisa membuat jadwal pergantian lampu yang lebih ketat. Misalkan ia tidak ingin lebih dari 30% lampu padam di area lobi. Berarti ia perlu mencari waktu (jam penggunaan) di mana probabilitas _survival_-nya __0.7__.



