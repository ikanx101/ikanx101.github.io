---
title: "Untitled"
format:
  gfm:
    html-math-method: webtex
fig-dpi: 500
fig-width: 8
fig-height: 4.5
editor: visual
execute:
  warning: false
  echo: false
error: false
---

```{r}
#| include: false

setwd("~/ikanx101.github.io/_posts/geo marketing/post_9")

rm(list=ls())
gc()

library(dplyr)
library(tidyr)
library(ggplot2)
library(ggpubr)
library(ggmap)
library(janitor)
```

Beberapa minggu belakangan, beberapa departemen meminta kepada saya untuk melakukan *web scraping* beberapa kategori *point of interest* dari **Google Maps** dan **Google Places**. Tujuan mereka sederhana, yakni:

> Menentukan area atau POI mana yang harus digarap pada tahun ini. Syukur-syukur penggarapan ini akan meningkatkan omset perusahaan.

Setelah saya *scrape* dan berikan data kepada mereka, artinya **sudah menjadi kewajiban mereka** untuk menentukan area dan POI mana yang harus digarap. Lantas bagaimana caranya? *Jujurly*, saya kurang mengetahui hal tersebut tapi saya yakin mereka sudah punya pakem tersendiri.

------------------------------------------------------------------------

Sampai saat ini, saya sudah menuliskan [12 *posts* di blog saya ini terkait *geo marketing*](https://ikanx101.com/tags/#geomarketing). Jika saya hendak membantu rekan-rekan di kantor untuk **menentukan area dan POI yang hendak digarap**, apakah bisa digunakan cara seperti yang pernah saya tulis dari salah satu dari 12 *posts* tersebut? **Jawabannya *TENTU BISA!***.

> Saya pernah menuliskan beberapa analisa di *geo marketing* yang bisa jadi basis pengambilan keputusan tersebut.

*Nah*, pada *post* kali ini saya akan melakukan beberapa alternatif analisa lain yang belum pernah saya lakukan sebelumnya pada topik *geo marketing*. Beberapa analisa ini sebenarnya sudah pernah saya lakukan di topik lainnya tapi ternyata *works well* juga di *geo marketing*.

Sebagai contoh, saya akan melakukan analisa untuk POI berupa **tempat makan kategori tertentu** di Kota Surabaya, tepatnya di Kecamatan Gubeng dan Genteng.


```{r}
load("analisa_1.rda")

key = "AIzaSyBlZpsnqIhuJDHZ-nGo1VrU3PmKDW18-ls"

register_google(key = key)

lisbon_satellite <- get_map("Kota Surabaya",
                            source = "google",
                            api_key = api_secret,zoom=13)

basis =
  df_sel %>%
  select(lat,long) %>%
  distinct()

ggmap(lisbon_satellite) +
  geom_point(data = basis,aes(x = long,y = lat),
             size = .9,
             color = "steelblue") +
  theme_void() +
  coord_equal()

```

Apa saja analisanya? *Cekidot!*

## Alternatif Analisa I: Kuadran *Rating* vs *User*

Analisa pertama yang hendak saya lakukan sebenarnya sangat sederhana, yakni cukup dengan membuat *scatter plot* antara *rating* dan berapa banyak *user* yang memberikan *rating*. Tujuannya adalah memetakan tempat makan mana yang termasuk ke dalam kuadran-kuadran sebagai berikut:

|                   | Review sedikit         | Review Banyak        |
|-------------------|------------------------|----------------------|
| **Rating tinggi** | *The Hidden gems*      | *The Populars*       |
| **Rating rendah** | *The Under performers* | *The Public critics* |

Dari peta ini, tentu strategi yang dijalankan per masing-masing kuadran akan berbeda. Mari kita lihat plot pertama sebagai berikut ini:

```{r}
p1
```

Kita bisa melihat bahwa kuadran yang dihasilkan secara visual sangat *mepet* dan tidak tersebar secara proporsional. Hal ini terjadi karena *range* dari data banyaknya *user* yang memberikan *rating* sangat jauh besar dan *skewed* ke salah satu sisi. Oleh karena itu, saya bisa melakukan transformasi dengan menggunakan fungsi logaritmik. Berikut adalah grafik kedua:

```{r}
p2
```

Setelah ditransformasi, sumbu *x* sudah relatif menyebar rata **tapi** data pada *rating* yang masih *skewed*. Jika dibuat kuadran, maka bentuknya seperti ini:

```{r}
p3
```

```{r}
df_sel %>% 
  tabyl(kuadran) %>% 
  adorn_pct_formatting() %>% 
  adorn_totals() %>% 
  knitr::kable()
```

Dari analisa ini, tim terkait bisa memilih kuadran tertentu sebagai target POI yang hendak diajak kerja sama.

**TAPI menurut keyakinan saya**, untuk data dengan rentang yang terlalu mepet atau terlalu lebar dan tergambarkan sebagai *skewed distribution*, alternatif analisa ini bisa menimbulkan bias dan kurang tepat untuk digunakan.

## Alternatif Analisa II: *Spatial Clustering \>\< K-Means Clustering*

Pada analisa ini, saya akan melakukan [dua teknik *clustering* yang berbeda](https://ikanx101.com/blog/clustering-R/), yakni:

1.  DBscan untuk mengelompokkan tempat-tempat makan yang berdekatan di suatu area berdasarkan data *longlat*-nya.
2.  K-Means untuk mengelompokkan tempat-tempat makan berdasarkan *rating* dan berapa banyak *user* yang memberikan rating.

Tujuannya adalah menjawab pertanyaan berikut ini:

1.  Apakah tempat-tempat makan dengan *rating* tinggi cenderung berkumpul di area elit tertentu?
2.  Apakah ada pusat kuliner baru yang terbentuk secara organik?

Berikut adalah *summary* hasilnya:

![](dashboard_clustering.png){width="550"}

```{r}
rm(list=ls())
load("analisa_2.rda")
colnames(df_sel)
df_sel %>% tabyl(kmeans_cluster)
```

1. Ada 13 _clusters_ spasial plus 1 _noise cluster_ spasial.
1. Ada empat _clusters_ berdasarkan _rating_ dan berapa banyak _user_ yang memberikan _rating_. _Cluster_ __*The Popular*__ dan __*The Exclusive*__ akan menjadi poin penting untuk menentukan area spasial kelak.

```{r}
kmeans_summary <- df_sel %>%
  group_by(kmeans_cluster_label) %>%
  summarise(
    n_restoran = n(),
    avg_rating = mean(rating, na.rm = TRUE),
    avg_user_rating = mean(user_rating, na.rm = TRUE),
    median_rating = median(rating, na.rm = TRUE),
    median_user_rating = median(user_rating, na.rm = TRUE),
    prop_high_rating = sum(rating >= 4.5) / n(),
    prop_popular = sum(user_rating >= 100) / n()
  )

kmeans_summary %>% knitr::kable()
```

Sekarang kita akan menjawab kedua pertanyaan yang ada dari grafik dan perhitungan yang sudah saya lakukan.

**Apakah restoran dengan _rating_ tinggi cenderung berkumpul di area elit tertentu?** 

Perhatikan grafik berikut ini:

![](plot_5.png){width="550"}

Plot ini adalah gabungan dari analisa _clustering spatial_ dengan _clustering_ berdasarkan _rating_ dan _user_. Jika tempat-tempat makan yang termasuk ke dalam _the Viral Venues_ dan _the Exclusive_ terkonsentrasi di area spasial tertentu, itu mengindikasikan suatu area termasuk ke dalam elit. Untuk menentukannya, saya akan membuat skor dengan membobotkan proporsi jenis tempat makan yang ada. 

Bobot tertinggi untuk tempat makan _the Viral Venues_, kemudian _the Exclusive_, lalu _the Trusted_. Sebagai contoh, bobot yang saya gunakan __tergantung dari keyakinan saya *ya*__.

```{r}
df_skor = 
  df_sel %>% 
  tabyl(dbscan_cluster,kmeans_cluster_label) %>% 
  adorn_percentages("row") %>% 
  mutate(skor = 2 * `The Viral Venues` + `The Exclusive` + .5 * `The Trusted`) %>% 
  arrange(desc(skor)) %>% 
  select(dbscan_cluster,skor) %>% 
  mutate(skor = skor * 100,
         skor = round(skor,2)) 

df_sel %>% 
  tabyl(dbscan_cluster,kmeans_cluster_label) %>% 
  adorn_percentages("row") %>%
  adorn_totals("col") %>% 
  adorn_pct_formatting() %>% 
  merge(df_skor) %>% 
  arrange(desc(skor)) %>% knitr::kable()
```

Saya dapatkan _cluster spasial_ ke 5 dan 9 memiliki skor tertinggi, yakni mereka yang berada pada:

```{r}
key = "AIzaSyBlZpsnqIhuJDHZ-nGo1VrU3PmKDW18-ls"

register_google(key = key)

lisbon_satellite <- get_map("Tunjungan Plaza, Kota Surabaya",
                            source = "google",
                            api_key = api_secret,zoom=15)

basis =
  df_sel %>%
  filter(dbscan_cluster %in% c(9,5)) %>% 
  select(lat,long,dbscan_cluster) %>%
  distinct()

ggmap(lisbon_satellite) +
  geom_point(data = basis,aes(x = long,y = lat,color = dbscan_cluster),
             size = 1.2) +
  scale_color_manual(values = c("blue","green")) +
  theme_void() +
  coord_equal() +
  labs(color = "Cluster Spasial ke-")
```

**Apakah ada pusat kuliner baru yang terbentuk secara organik?** 

Saya akan membuat definisi __tempat makan baru__ berdasarkan banyak _user_ yang memberikan _rating_. Jika "sedikit", maka saya asumsikan tempat makan tersebut merupakan tempat makan baru. Berikut ini adalah _cluster_ spasial yang memiliki tempat-tempat makan baru terbanyak di antara _clusters_ yang lain:

```{r}
cluster_baru = 
  df_sel %>% 
  mutate(baru = ifelse(user_rating < 30,T,F)) %>% 
  group_by(dbscan_cluster) %>% 
  summarise(new = sum(baru) / length(baru)) %>% 
  ungroup() %>% 
  arrange(desc(new)) %>% 
  head(3) %>% pull(dbscan_cluster)
  

lisbon_satellite <- get_map("Universitas Airlangga Kampus B, Kota Surabaya",
                            source = "google",
                            api_key = api_secret,zoom=14)

basis =
  df_sel %>%
  filter(dbscan_cluster %in% cluster_baru) %>% 
  select(lat,long,dbscan_cluster) %>%
  distinct()

ggmap(lisbon_satellite) +
  geom_point(data = basis,aes(x = long,y = lat,color = dbscan_cluster),
             size = 1.2) +
  scale_color_manual(values = c("blue","green","purple")) +
  theme_void() +
  coord_equal() +
  labs(color = "Cluster Spasial ke-")

```

colnames(df_sel)


- DBSCAN akan mengidentifikasi cluster spasial yang terbentuk alami - Analisis karakteristik cluster (proporsi restoran baru, rating, lokasi) - Cluster di lokasi non-tradisional dengan pola rating unik dapat mengindikasikan pusat kuliner baru

### **6. Keunggulan Skrip:**

-   **Reproduktibilitas**: Menggunakan set.seed untuk hasil konsisten
-   **Optimasi Parameter**: Metode objektif untuk menentukan parameter optimal
-   **Visualisasi Komprehensif**: 8 plot dengan tema yang konsisten dan menarik
-   **Interpretasi Bisnis**: Analisis yang dapat ditindaklanjuti untuk keputusan bisnis
-   **Ekspor Otomatis**: Semua hasil diekspor dalam format yang mudah digunakan
